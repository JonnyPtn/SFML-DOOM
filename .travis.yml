language: c++
sudo: false
addons:
  apt:
    packages:
    - cmake
    - libxrandr-dev
    - libudev-dev
    - libopenal-dev
    - libflac-dev
    - libvorbis-dev
    - libenet-dev
    - libgtk-3-dev
    - g++-7
    - gcc-7
    - clang
    sources:
    - ubuntu-toolchain-r-test

before_script:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-7 90; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-7 90; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then brew update; brew install sfml enet; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then git clone https://github.com/sfml/sfml && cd sfml && cmake . && sudo cmake --build . --target install && cd ..; fi

script:
- mkdir build && cd build
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cmake .. -GXcode -DMACOS_BUNDLE=TRUE -DCMAKE_BUILD_TYPE=Release; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cmake .. -DCMAKE_BUILD_TYPE=Release; fi
- sudo cmake --build . --target package --config Release

# Copy anything for deployment into the deploy folder
- cd ../ && mkdir deploy
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then cp -r build/*.deb deploy; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then cp -r build/*.dmg deploy; fi
matrix:
  include:
  - os: linux
    compiler: gcc

  - os: linux
    compiler: clang

  - os: osx
    osx_image: xcode8.3

  - os: osx
    osx_image: xcode9
    
deploy:
  provider: s3
  access_key_id: $ARTIFACTS_KEY
  secret_access_key: $ARTIFACTS_SECRET
  bucket: sfml-doom-builds
  region: us-east-1
  skip_cleanup: true
  local_dir: deploy

 # For some reason enabling this causes it to stop deploying because the repo isn't in the list :S
 # on:
 #   repo: 
 #   - fallahn/xygine 
 #   - JonnyPtn/xygine
